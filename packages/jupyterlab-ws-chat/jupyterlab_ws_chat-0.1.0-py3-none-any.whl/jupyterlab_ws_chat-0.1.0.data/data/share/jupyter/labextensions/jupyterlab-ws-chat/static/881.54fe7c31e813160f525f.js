"use strict";(self.webpackChunkjupyterlab_ws_chat=self.webpackChunkjupyterlab_ws_chat||[]).push([[881],{3881:(e,t,n)=>{n.r(t),n.d(t,{ChatModel:()=>i,ChatWidget:()=>X,buildChatSidebar:()=>Q,buildErrorWidget:()=>f,chatIcon:()=>a});var r=n(1527);const a=new r.LabIcon({name:"jupyter-chat::chat",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16">\n  <g class="jp-icon3" fill="#616161">\n    <path d="M0 0h24v24H0V0z" fill="none"/>\n    <path d="M15 4v7H5.17L4 12.17V4h11m1-2H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm5 4h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1z"/>\n  </g>\n</svg>\n'});var s=n(4602);class i{constructor(e={}){var t;this._messages=[],this._id="",this._isDisposed=!1,this._messagesUpdated=new s.Signal(this),this._config=null!==(t=e.config)&&void 0!==t?t:{}}get messages(){return this._messages}get id(){return this._id}set id(e){this._id=e}get config(){return this._config}set config(e){this._config={...this._config,...e}}get messagesUpdated(){return this._messagesUpdated}addMessage(e){}dispose(){this.isDisposed||(this._isDisposed=!0)}get isDisposed(){return this._isDisposed}formatChatMessage(e){return e}messageAdded(e){const t=this._messages.findIndex((t=>t.id===e.id));t>-1&&this._messages.splice(t,1);let n=this._messages.findIndex((t=>t.time>e.time));-1===n&&(n=this._messages.length),this.messagesInserted(n,[e])}messagesInserted(e,t){const n=[];t.forEach((e=>{n.push(this.formatChatMessage(e))})),this._messages.splice(e,0,...n),this._messagesUpdated.emit()}messagesDeleted(e,t){this._messages.splice(e,t),this._messagesUpdated.emit()}}var o=n(5923),l=n(3251),c=n(406),d=n(3345),m=n.n(d),u=n(2276),h=n(3325);function p(e){return getComputedStyle(document.body).getPropertyValue(e).trim()}function g(e){const[t,n]=(0,d.useState)((0,u.A)());return(0,d.useEffect)((()=>{var t;async function r(){n(await async function(){await async function(){for(;!document.body.hasAttribute("data-jp-theme-light");)await new Promise((e=>setTimeout(e,100)))}();const e=document.body.getAttribute("data-jp-theme-light");return(0,u.A)({spacing:4,components:{MuiButton:{defaultProps:{size:"small"}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense",size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"}},MuiTable:{defaultProps:{size:"small"}},MuiTextField:{defaultProps:{margin:"dense",size:"small"}},MuiToolbar:{defaultProps:{variant:"dense"}}},palette:{background:{paper:p("--jp-layout-color1"),default:p("--jp-layout-color1")},mode:"true"===e?"light":"dark",primary:{main:p("--jp-brand-color1"),light:p("--jp-brand-color2"),dark:p("--jp-brand-color0")},error:{main:p("--jp-error-color1"),light:p("--jp-error-color2"),dark:p("--jp-error-color0")},warning:{main:p("--jp-warn-color1"),light:p("--jp-warn-color2"),dark:p("--jp-warn-color0")},success:{main:p("--jp-success-color1"),light:p("--jp-success-color2"),dark:p("--jp-success-color0")},text:{primary:p("--jp-ui-font-color1"),secondary:p("--jp-ui-font-color2"),disabled:p("--jp-ui-font-color3")}},shape:{borderRadius:2},typography:{fontFamily:p("--jp-ui-font-family"),fontSize:12,htmlFontSize:16,button:{textTransform:"capitalize"}}})}())}r(),null===(t=e.themeManager)||void 0===t||t.themeChanged.connect(r)}),[]),m().createElement(h.A,{theme:t},e.children)}function f(e){const t=o.ReactWidget.create(m().createElement(g,{themeManager:e},m().createElement(l.A,{sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},m().createElement(l.A,{sx:{padding:4}},m().createElement(c.A,{severity:"error"},"There seems to be a problem with the Chat backend, please look at the JupyterLab server logs or contact your administrator to correct this problem.")))));return t.id="jupyter-chat::chat",t.title.icon=a,t.title.caption="Jupyter Chat",t}var E=n(7446),y=n(4087),v=n(6309),x=n(4079),b=n(9578),w=n(3099),C=n(4838),A=n(9663),S=n(2753),j=n(9260),M=n(1656);const _="jp-chat-input-container",k="jp-chat-send-button",R="jp-chat-cancel-button";function T(e){const[t,n]=(0,d.useState)(e.value||"");function r(){n(""),e.onSend(t)}const a=e.sendWithShiftEnter?m().createElement("span",null,"Press ",m().createElement("b",null,"Shift"),"+",m().createElement("b",null,"Enter")," to send message"):m().createElement("span",null,"Press ",m().createElement("b",null,"Shift"),"+",m().createElement("b",null,"Enter")," to add a new line");return m().createElement(l.A,{sx:e.sx,className:(0,C.A)(_)},m().createElement(l.A,{sx:{display:"flex"}},m().createElement(A.A,{value:t,onChange:e=>n(e.target.value),fullWidth:!0,variant:"outlined",multiline:!0,onKeyDown:function(t){"Enter"===t.key&&(e.sendWithShiftEnter&&t.shiftKey||!e.sendWithShiftEnter&&!t.shiftKey)&&(r(),t.stopPropagation(),t.preventDefault())},placeholder:"Start chatting",InputProps:{endAdornment:m().createElement(S.A,{position:"end"},e.onCancel&&m().createElement(v.A,{size:"small",color:"primary",onClick:function(){n(e.value||""),e.onCancel()},disabled:!t.trim().length,title:"Cancel edition",className:(0,C.A)(R)},m().createElement(j.A,null)),m().createElement(v.A,{size:"small",color:"primary",onClick:r,disabled:!t.trim().length,title:"Send message "+(e.sendWithShiftEnter?"(SHIFT+ENTER)":"(ENTER)"),className:(0,C.A)(k)},m().createElement(M.A,null)))},FormHelperTextProps:{sx:{marginLeft:"auto",marginRight:0}},helperText:t.length>2?a:" "})))}var P,z=n(7628),I=n.n(z),N=n(4057);!function(e){e[e.None=0]="None",e[e.Copied=1]="Copied"}(P||(P={}));const D={[P.None]:"Copy to Clipboard",[P.Copied]:"Copied!"};function W(e){const[t,n]=(0,d.useState)(P.None),r=(0,d.useCallback)((async()=>{try{await navigator.clipboard.writeText(e.value)}catch(e){return console.error("Failed to copy text: ",e),void n(P.None)}n(P.Copied),setTimeout((()=>n(P.None)),1e3)}),[e.value]);return m().createElement(l.A,{sx:{display:"flex",flexDirection:"column"}},m().createElement(N.A,{onClick:r,disabled:t!==P.None,"aria-label":"Copy To Clipboard",sx:{alignSelf:"flex-end",textTransform:"none"}},D[t]))}function V(e){const t=[];if(void 0!==e.edit){const n=(0,r.ToolbarButtonComponent)({icon:r.editIcon,onClick:e.edit,tooltip:"Edit"});t.push(n)}if(void 0!==e.delete){const n=(0,r.ToolbarButtonComponent)({icon:r.deleteIcon,onClick:e.delete,tooltip:"Delete"});t.push(n)}return m().createElement("div",{className:"jp-chat-toolbar"},t.map((e=>e)))}const F="text/markdown",B=m().memo((function(e){const t=e.appendContent||!1,[n,r]=(0,d.useState)(null),a=(0,d.useRef)(null);return(0,d.useEffect)((()=>{(async()=>{var t;const n=e.markdownStr.replace("\\(","\\\\(").replace("\\)","\\\\)").replace("\\[","\\\\[").replace("\\]","\\\\]"),s=e.rmRegistry.createModel({data:{[F]:n}}),i=e.rmRegistry.createRenderer(F);await i.renderModel(s),null===(t=e.rmRegistry.latexTypesetter)||void 0===t||t.typeset(i.node),a.current&&i.node&&i.node.querySelectorAll("pre").forEach((e=>{var t;const n=document.createElement("div");null===(t=e.parentNode)||void 0===t||t.insertBefore(n,e.nextSibling),I().render(m().createElement(W,{value:e.textContent||""}),n)})),r(i.node)})()}),[e.markdownStr,e.rmRegistry]),m().createElement("div",{ref:a,className:"jp-chat-rendermime-markdown"},n&&(t?m().createElement("div",{ref:e=>e&&e.appendChild(n)}):m().createElement("div",{ref:e=>e&&e.replaceChildren(n)})),m().createElement(V,{edit:e.edit,delete:e.delete}))})),H="jp-chat-messages-container",L="jp-chat-message",U="jp-chat-message-header",J="jp-chat-message-time";function K(e){var t,n;const[r,a]=(0,d.useState)({}),s={height:"24px",width:"24px"};(0,d.useEffect)((()=>{if(!r[e.timestamp]){const t={};let n;const r=new Date,s=e=>e.getFullYear()===r.getFullYear()&&e.getMonth()===r.getMonth()&&e.getDate()===r.getDate(),i=new Date(1e3*e.timestamp);n=s(i)?i.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):i.toLocaleString([],{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),t[e.timestamp]=n,a(t)}}));const i=e.color,o=e.avatar_url?m().createElement(b.A,{sx:{...s,...i&&{bgcolor:i}},src:e.avatar_url}):e.initials?m().createElement(b.A,{sx:{...s,...i&&{bgcolor:i}}},m().createElement(w.A,{sx:{fontSize:"var(--jp-ui-font-size1)",color:"var(--jp-ui-inverse-font-color1)"}},e.initials)):null,c=null!==(n=null!==(t=e.display_name)&&void 0!==t?t:e.name)&&void 0!==n?n:e.username||"User undefined";return m().createElement(l.A,{className:U,sx:{display:"flex",alignItems:"center","& > :not(:last-child)":{marginRight:3},...e.sx}},o,m().createElement(l.A,{sx:{display:"flex",flexGrow:1,flexWrap:"wrap",justifyContent:"space-between",alignItems:"center"}},m().createElement(l.A,{sx:{display:"flex",alignItems:"center"}},m().createElement(w.A,{sx:{fontWeight:700,color:"var(--jp-ui-font-color1)"}},c),(e.deleted||e.edited)&&m().createElement(w.A,{sx:{fontStyle:"italic",fontSize:"var(--jp-content-font-size0)",paddingLeft:"0.5em"}},e.deleted?"(message deleted)":"(edited)")),m().createElement(w.A,{className:J,sx:{fontSize:"0.8em",color:"var(--jp-ui-font-color2)",fontWeight:300},title:e.rawTime?"Unverified time":""},`${r[e.timestamp]}${e.rawTime?"*":""}`)))}function Y(e){return m().createElement(l.A,{sx:{"& > :not(:last-child)":{borderBottom:"1px solid var(--jp-border-color2)"}},className:(0,C.A)(H)},e.messages.map(((t,n)=>{let r;return r="string"==typeof t.sender?{username:t.sender}:t.sender,m().createElement(l.A,{key:n,sx:{padding:"1em 1em 0 1em"},className:(0,C.A)(L)},m().createElement(K,{...r,timestamp:t.time,rawTime:t.raw_time,deleted:t.deleted,edited:t.edited,sx:{marginBottom:3}}),m().createElement($,{...e,message:t}))})))}function $(e){var t;const{message:n,model:r,rmRegistry:a}=e;let s=!1,i=!1;if(void 0!==r.user&&!n.deleted){const e="string"==typeof n.sender?n.sender:n.sender.username;r.user.username===e&&void 0!==r.updateMessage&&(s=!0),r.user.username===e&&void 0!==r.deleteMessage&&(i=!0)}const[o,l]=(0,d.useState)(!1);return n.deleted?m().createElement(m().Fragment,null):m().createElement("div",null,o&&s?m().createElement(T,{value:n.body,onSend:e=>((e,t)=>{if(!s)return;const a={...n};a.body=t,r.updateMessage(e,a),l(!1)})(n.id,e),onCancel:()=>{l(!1)},sendWithShiftEnter:null!==(t=r.config.sendWithShiftEnter)&&void 0!==t&&t}):m().createElement(B,{rmRegistry:a,markdownStr:n.body,edit:s?()=>l(!0):void 0,delete:i?()=>{return e=n.id,void(i&&r.deleteMessage(e));var e}:void 0}))}function q(e){const t=(0,d.useMemo)((()=>"jupyter-chat-scroll-container-"+Date.now().toString()),[]);return(0,d.useEffect)((()=>{const e=document.querySelector(`#${t}`);if(!e)return;const n=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&e.scroll({top:999999999})}))}),{threshold:1});return n.observe(e),()=>n.disconnect()}),[]),m().createElement(l.A,{id:t,sx:{overflowY:"scroll","& *":{overflowAnchor:"none"},...e.sx}},m().createElement(l.A,{sx:{minHeight:"100.01%"}},e.children),m().createElement(l.A,{sx:{overflowAnchor:"auto",height:"1px"}}))}function G({model:e,rmRegistry:t}){var n;const[r,a]=(0,d.useState)([]);return(0,d.useEffect)((()=>{!async function(){e.getHistory&&e.getHistory().then((e=>a(e.messages))).catch((e=>console.error(e)))}()}),[e]),(0,d.useEffect)((()=>{function t(t){a([...e.messages])}return e.messagesUpdated.connect(t),function(){e.messagesUpdated.disconnect(t)}}),[e]),m().createElement(m().Fragment,null,m().createElement(q,{sx:{flexGrow:1}},m().createElement(Y,{messages:r,rmRegistry:t,model:e})),m().createElement(T,{onSend:async t=>{e.addMessage({body:t})},sx:{paddingLeft:4,paddingRight:4,paddingTop:3.5,paddingBottom:0,borderTop:"1px solid var(--jp-border-color1)"},sendWithShiftEnter:null!==(n=e.config.sendWithShiftEnter)&&void 0!==n&&n}))}function O(e){var t;const[n,r]=(0,d.useState)(e.chatView||O.ChatView.Chat);return m().createElement(g,{themeManager:null!==(t=e.themeManager)&&void 0!==t?t:null},m().createElement(x.A,{sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},m().createElement(x.A,{sx:{display:"flex",justifyContent:"space-between"}},n!==O.ChatView.Chat?m().createElement(v.A,{onClick:()=>r(O.ChatView.Chat)},m().createElement(E.A,null)):m().createElement(x.A,null),n===O.ChatView.Chat&&e.settingsPanel?m().createElement(v.A,{onClick:()=>r(O.ChatView.Settings)},m().createElement(y.A,null)):m().createElement(x.A,null)),n===O.ChatView.Chat&&m().createElement(G,{model:e.model,rmRegistry:e.rmRegistry}),n===O.ChatView.Settings&&e.settingsPanel&&m().createElement(e.settingsPanel,null)))}function Q(e,t,n){const r=o.ReactWidget.create(m().createElement(O,{model:e,themeManager:t,rmRegistry:n}));return r.id="jupyter-chat::side-panel",r.title.icon=a,r.title.caption="Jupyter Chat",r}!function(e){let t;!function(e){e[e.Chat=0]="Chat",e[e.Settings=1]="Settings"}(t=e.ChatView||(e.ChatView={}))}(O||(O={}));class X extends o.ReactWidget{constructor(e){super(),this.id="jupyter-chat::widget",this.title.icon=a,this.title.caption="Jupyter Chat",this._model=e.model,this._themeManager=(null==e?void 0:e.themeManager)||null,this._rmRegistry=e.rmRegistry}get model(){return this._model}render(){return m().createElement(O,{model:this._model,themeManager:this._themeManager,rmRegistry:this._rmRegistry})}}}}]);