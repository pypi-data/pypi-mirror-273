{"hat-event": {"mariner.yaml": {"id": "hat-event://mariner.yaml#", "title": "Mariner communication messages", "oneOf": [{"$ref": "hat-event://mariner.yaml#/definitions/messages/ping"}, {"$ref": "hat-event://mariner.yaml#/definitions/messages/pong"}, {"$ref": "hat-event://mariner.yaml#/definitions/messages/init"}, {"$ref": "hat-event://mariner.yaml#/definitions/messages/events"}], "definitions": {"messages": {"ping": {"type": "object", "required": ["type"], "properties": {"type": {"const": "ping"}}}, "pong": {"type": "object", "required": ["type"], "properties": {"type": {"const": "pong"}}}, "init": {"type": "object", "required": ["type", "client_id", "client_token", "last_event_id", "subscriptions"], "properties": {"type": {"const": "init"}, "client_id": {"type": "string"}, "client_token": {"type": ["string", "null"]}, "last_event_id": {"oneOf": [{"type": "null"}, {"$ref": "hat-event://mariner.yaml#/definitions/event_id"}]}, "subscriptions": {"type": "array", "items": {"$ref": "hat-event://mariner.yaml#/definitions/event_type"}}}}, "events": {"type": "object", "required": ["type", "events"], "properties": {"type": {"const": "events"}, "events": {"type": "array", "items": {"$ref": "hat-event://mariner.yaml#/definitions/event"}}}}}, "event_id": {"type": "object", "required": ["server", "session", "instance"], "properties": {"server": {"type": "integer"}, "session": {"type": "integer"}, "instance": {"type": "integer"}}}, "event_type": {"type": "array", "items": {"type": "string"}}, "timestamp": {"type": "object", "required": ["s", "us"], "properties": {"s": {"type": "integer"}, "us": {"type": "integer"}}}, "payload": {"oneOf": [{"type": "object", "required": ["type", "data"], "properties": {"type": {"const": "binary"}, "data": {"type": "string"}}}, {"type": "object", "required": ["type", "data"], "properties": {"type": {"const": "json"}}}, {"type": "object", "required": ["type", "data"], "properties": {"type": {"const": "sbs"}, "data": {"type": "object", "required": ["module", "type", "data"], "properties": {"module": {"module": ["null", "string"], "type": {"type": "string"}, "data": {"type": "bytes"}}}}}}]}, "event": {"type": "object", "required": ["id", "type", "timestamp", "source_timestamp", "payload"], "properties": {"id": {"$ref": "hat-event://mariner.yaml#/definitions/event_id"}, "type": {"$ref": "hat-event://mariner.yaml#/definitions/event_type"}, "timestamp": {"$ref": "hat-event://mariner.yaml#/definitions/timestamp"}, "source_timestamp": {"oneOf": ["null", {"$ref": "hat-event://mariner.yaml#/definitions/timestamp"}]}, "payload": {"oneOf": ["null", {"$ref": "hat-event://mariner.yaml#/definitions/payload"}]}}}}}, "server.yaml": {"id": "hat-event://server.yaml#", "title": "Event Server", "description": "Event Server's configuration", "type": "object", "required": ["type", "log", "backend", "engine", "eventer_server"], "properties": {"type": {"const": "event", "description": "configuration type identification"}, "version": {"type": "string", "description": "component version"}, "syncer_token": {"type": "string", "description": "match of event servers' syncer_token is necessery condition for \ntheir synchronization\n"}, "syncer_client_ping_timeout": {"type": ["null", "number"]}, "monitor": {"$ref": "hat-monitor://client.yaml#"}, "log": {"$ref": "hat-json://logging.yaml#"}, "backend": {"$ref": "hat-event://server.yaml#/definitions/backend"}, "engine": {"$ref": "hat-event://server.yaml#/definitions/engine"}, "eventer_server": {"$ref": "hat-event://server.yaml#/definitions/eventer_server"}, "syncer_server": {"$ref": "hat-event://server.yaml#/definitions/syncer_server"}, "mariner_server": {"$ref": "hat-event://server.yaml#/definitions/mariner_server"}, "synced_restart_engine": {"type": "boolean"}}, "definitions": {"backend": {"type": "object", "description": "structure of backend configuration depends on backend type\n", "required": ["module"], "properties": {"module": {"type": "string", "description": "full python module name that implements backend\n"}}}, "module": {"type": "object", "description": "structure of module configuration depends on module type\n", "required": ["module"], "properties": {"module": {"type": "string", "description": "full python module name that implements module\n"}}}, "engine": {"type": "object", "required": ["server_id", "modules"], "properties": {"server_id": {"type": "integer"}, "modules": {"type": "array", "items": {"$ref": "hat-event://server.yaml#/definitions/module"}}}}, "eventer_server": {"type": "object", "required": ["address"], "properties": {"address": {"type": "string", "default": "tcp+sbs://127.0.0.1:23012"}}}, "syncer_server": {"type": "object", "required": ["address"], "properties": {"address": {"type": "string", "default": "tcp+sbs://127.0.0.1:23013"}, "token": {"type": ["null", "string"]}, "subscriptions": {"$ref": "hat-event://server.yaml#/definitions/event_types"}, "ping_timeout": {"type": ["null", "number"]}}}, "mariner_server": {"type": "object", "required": ["address", "subscriptions"], "properties": {"address": {"type": "string", "default": "tcp://127.0.0.1:23014"}, "subscriptions": {"$ref": "hat-event://server.yaml#/definitions/event_types"}, "server_token": {"type": ["null", "string"]}}}, "events": {"eventer": {"enum": ["CONNECTED", "DISCONNECTED"]}, "syncer": {"server": {"type": "array", "items": {"type": "object", "required": ["client_name", "synced"], "properties": {"client_name": {"type": "string"}, "synced": {"type": "boolean"}}}}, "client": {"type": "boolean"}}, "engine": {"enum": ["STARTED", "STOPPED"]}}, "event_types": {"type": "array", "items": {"type": "array", "items": {"type": "string"}}}}}, "monitor_data.yaml": {"id": "hat-event://monitor_data.yaml#", "title": "monitor data", "description": "data property of monitor component info", "type": "object", "required": ["eventer_server_address", "syncer_server_address", "server_id"], "properties": {"eventer_server_address": {"type": "string"}, "syncer_server_address": {"type": "string"}, "server_id": {"type": "integer"}, "syncer_token": {"type": "string"}}}, "backends/lmdb.yaml": {"id": "hat-event://backends/lmdb.yaml#", "title": "LMDB backend", "type": "object", "required": ["db_path", "max_db_size", "flush_period", "conditions", "latest", "ordered"], "properties": {"db_path": {"type": "string"}, "max_db_size": {"type": "number"}, "flush_period": {"type": "number"}, "conditions": {"type": "array", "items": {"type": "object", "required": ["subscriptions", "condition"], "properties": {"subscriptions": {"$ref": "hat-event://backends/lmdb.yaml#/definitions/event_types"}, "condition": {"$ref": "hat-event://backends/lmdb.yaml#/definitions/condition"}}}}, "latest": {"type": "object", "required": ["subscriptions"], "properties": {"subscriptions": {"$ref": "hat-event://backends/lmdb.yaml#/definitions/event_types"}}}, "ordered": {"type": "array", "items": {"type": "object", "required": ["order_by", "subscriptions"], "properties": {"order_by": {"enum": ["TIMESTAMP", "SOURCE_TIMESTAMP"]}, "subscriptions": {"$ref": "hat-event://backends/lmdb.yaml#/definitions/event_types"}, "limit": {"$ref": "hat-event://backends/lmdb.yaml#/definitions/limit"}}}}}, "definitions": {"event_types": {"type": "array", "items": {"type": "array", "items": {"type": "string"}}}, "limit": {"type": "object", "properties": {"min_entries": {"type": "number", "description": "number of entries kept despite of other limits\n"}, "max_entries": {"type": "number", "description": "maximum number of entries\n"}, "duration": {"type": "number", "description": "limit for the persisted history based on keys\nexpressed as duration in seconds\n"}, "size": {"type": "number", "description": "memory consumption size in bytes that triggers\nadditional cleanup based on average entry size\n"}}}, "condition": {"oneOf": [{"$ref": "hat-event://backends/lmdb.yaml#/definitions/conditions/all"}, {"$ref": "hat-event://backends/lmdb.yaml#/definitions/conditions/any"}, {"$ref": "hat-event://backends/lmdb.yaml#/definitions/conditions/json"}]}, "conditions": {"all": {"type": "object", "required": ["type", "conditions"], "properties": {"type": {"const": "all"}, "conditions": {"type": "array", "items": {"$ref": "hat-event://backends/lmdb.yaml#/definitions/condition"}}}}, "any": {"type": "object", "required": ["type", "conditions"], "properties": {"type": {"const": "any"}, "conditions": {"type": "array", "items": {"$ref": "hat-event://backends/lmdb.yaml#/definitions/condition"}}}}, "json": {"type": "object", "required": ["type"], "properties": {"type": {"const": "json"}, "data_path": {"$ref": "hat-event://backends/lmdb.yaml#/definitions/path"}, "data_type": {"enum": ["null", "boolean", "string", "number", "array", "object"]}, "data_value": {}}}}, "path": {"oneOf": [{"type": "string"}, {"type": "integer"}, {"type": "array", "items": {"$ref": "hat-event://backends/lmdb.yaml#/definitions/path"}}]}}}, "backends/sqlite.yaml": {"id": "hat-event://backends/sqlite.yaml#", "title": "Sqlite backend", "description": "Sqlite backend configuration", "type": "object", "required": ["db_path", "query_pool_size"], "properties": {"db_path": {"type": "string", "description": "path to sqlite database file"}, "query_pool_size": {"type": "integer", "description": "number of connections in a pool used for querying\n"}}}}}