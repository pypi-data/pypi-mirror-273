!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@lumino/commands"),require("@lumino/coreutils"),require("@lumino/widgets")):"function"==typeof define&&define.amd?define(["exports","@lumino/commands","@lumino/coreutils","@lumino/widgets"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).lumino_application={},e.lumino_commands,e.lumino_coreutils,e.lumino_widgets)}(this,(function(e,t,n,i){"use strict";var r,o,s,l;!function(e){function t(e,t,n=0,i=-1){let r,o=e.length;if(0===o)return-1;n=n<0?Math.max(0,n+o):Math.min(n,o-1),r=(i=i<0?Math.max(0,i+o):Math.min(i,o-1))<n?i+1+(o-n):i-n+1;for(let i=0;i<r;++i){let r=(n+i)%o;if(e[r]===t)return r}return-1}function n(e,t,n=-1,i=0){let r,o=e.length;if(0===o)return-1;r=(n=n<0?Math.max(0,n+o):Math.min(n,o-1))<(i=i<0?Math.max(0,i+o):Math.min(i,o-1))?n+1+(o-i):n-i+1;for(let i=0;i<r;++i){let r=(n-i+o)%o;if(e[r]===t)return r}return-1}function i(e,t,n=0,i=-1){let r,o=e.length;if(0===o)return-1;n=n<0?Math.max(0,n+o):Math.min(n,o-1),r=(i=i<0?Math.max(0,i+o):Math.min(i,o-1))<n?i+1+(o-n):i-n+1;for(let i=0;i<r;++i){let r=(n+i)%o;if(t(e[r],r))return r}return-1}function r(e,t,n=-1,i=0){let r,o=e.length;if(0===o)return-1;r=(n=n<0?Math.max(0,n+o):Math.min(n,o-1))<(i=i<0?Math.max(0,i+o):Math.min(i,o-1))?n+1+(o-i):n-i+1;for(let i=0;i<r;++i){let r=(n-i+o)%o;if(t(e[r],r))return r}return-1}function o(e,t=0,n=-1){let i=e.length;if(!(i<=1))for(t=t<0?Math.max(0,t+i):Math.min(t,i-1),n=n<0?Math.max(0,n+i):Math.min(n,i-1);t<n;){let i=e[t],r=e[n];e[t++]=r,e[n--]=i}}function s(e,t){let n=e.length;if(t<0&&(t+=n),t<0||t>=n)return;let i=e[t];for(let i=t+1;i<n;++i)e[i-1]=e[i];return e.length=n-1,i}e.firstIndexOf=t,e.lastIndexOf=n,e.findFirstIndex=i,e.findLastIndex=r,e.findFirstValue=function(e,t,n=0,r=-1){let o=i(e,t,n,r);return-1!==o?e[o]:void 0},e.findLastValue=function(e,t,n=-1,i=0){let o=r(e,t,n,i);return-1!==o?e[o]:void 0},e.lowerBound=function(e,t,n,i=0,r=-1){let o=e.length;if(0===o)return 0;let s=i=i<0?Math.max(0,i+o):Math.min(i,o-1),l=(r=r<0?Math.max(0,r+o):Math.min(r,o-1))-i+1;for(;l>0;){let i=l>>1,r=s+i;n(e[r],t)<0?(s=r+1,l-=i+1):l=i}return s},e.upperBound=function(e,t,n,i=0,r=-1){let o=e.length;if(0===o)return 0;let s=i=i<0?Math.max(0,i+o):Math.min(i,o-1),l=(r=r<0?Math.max(0,r+o):Math.min(r,o-1))-i+1;for(;l>0;){let i=l>>1,r=s+i;n(e[r],t)>0?l=i:(s=r+1,l-=i+1)}return s},e.shallowEqual=function(e,t,n){if(e===t)return!0;if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;++i)if(n?!n(e[i],t[i]):e[i]!==t[i])return!1;return!0},e.slice=function(e,t={}){let{start:n,stop:i,step:r}=t;if(void 0===r&&(r=1),0===r)throw new Error("Slice `step` cannot be zero.");let o,s=e.length;void 0===n?n=r<0?s-1:0:n<0?n=Math.max(n+s,r<0?-1:0):n>=s&&(n=r<0?s-1:s),void 0===i?i=r<0?-1:s:i<0?i=Math.max(i+s,r<0?-1:0):i>=s&&(i=r<0?s-1:s),o=r<0&&i>=n||r>0&&n>=i?0:r<0?Math.floor((i-n+1)/r+1):Math.floor((i-n-1)/r+1);let l=[];for(let t=0;t<o;++t)l[t]=e[n+t*r];return l},e.move=function(e,t,n){let i=e.length;if(i<=1)return;if((t=t<0?Math.max(0,t+i):Math.min(t,i-1))===(n=n<0?Math.max(0,n+i):Math.min(n,i-1)))return;let r=e[t],o=t<n?1:-1;for(let i=t;i!==n;i+=o)e[i]=e[i+o];e[n]=r},e.reverse=o,e.rotate=function(e,t,n=0,i=-1){let r=e.length;if(r<=1)return;if((n=n<0?Math.max(0,n+r):Math.min(n,r-1))>=(i=i<0?Math.max(0,i+r):Math.min(i,r-1)))return;let s=i-n+1;if(t>0?t%=s:t<0&&(t=(t%s+s)%s),0===t)return;let l=n+t;o(e,n,l-1),o(e,l,i),o(e,n,i)},e.fill=function(e,t,n=0,i=-1){let r,o=e.length;if(0!==o){n=n<0?Math.max(0,n+o):Math.min(n,o-1),r=(i=i<0?Math.max(0,i+o):Math.min(i,o-1))<n?i+1+(o-n):i-n+1;for(let i=0;i<r;++i)e[(n+i)%o]=t}},e.insert=function(e,t,n){let i=e.length;t=t<0?Math.max(0,t+i):Math.min(t,i);for(let n=i;n>t;--n)e[n]=e[n-1];e[t]=n},e.removeAt=s,e.removeFirstOf=function(e,n,i=0,r=-1){let o=t(e,n,i,r);return-1!==o&&s(e,o),o},e.removeLastOf=function(e,t,i=-1,r=0){let o=n(e,t,i,r);return-1!==o&&s(e,o),o},e.removeAllOf=function(e,t,n=0,i=-1){let r=e.length;if(0===r)return 0;n=n<0?Math.max(0,n+r):Math.min(n,r-1),i=i<0?Math.max(0,i+r):Math.min(i,r-1);let o=0;for(let s=0;s<r;++s)n<=i&&s>=n&&s<=i&&e[s]===t||i<n&&(s<=i||s>=n)&&e[s]===t?o++:o>0&&(e[s-o]=e[s]);return o>0&&(e.length=r-o),o},e.removeFirstWhere=function(e,t,n=0,r=-1){let o,l=i(e,t,n,r);return-1!==l&&(o=s(e,l)),{index:l,value:o}},e.removeLastWhere=function(e,t,n=-1,i=0){let o,l=r(e,t,n,i);return-1!==l&&(o=s(e,l)),{index:l,value:o}},e.removeAllWhere=function(e,t,n=0,i=-1){let r=e.length;if(0===r)return 0;n=n<0?Math.max(0,n+r):Math.min(n,r-1),i=i<0?Math.max(0,i+r):Math.min(i,r-1);let o=0;for(let s=0;s<r;++s)n<=i&&s>=n&&s<=i&&t(e[s],s)||i<n&&(s<=i||s>=n)&&t(e[s],s)?o++:o>0&&(e[s-o]=e[s]);return o>0&&(e.length=r-o),o}}(r||(r={})),function(e){e.rangeLength=function(e,t,n){return 0===n?1/0:e>t&&n>0||e<t&&n<0?0:Math.ceil((t-e)/n)}}(o||(o={})),function(e){function t(e,t,n=0){let i=new Array(t.length);for(let r=0,o=n,s=t.length;r<s;++r,++o){if(o=e.indexOf(t[r],o),-1===o)return null;i[r]=o}return i}e.findIndices=t,e.matchSumOfSquares=function(e,n,i=0){let r=t(e,n,i);if(!r)return null;let o=0;for(let e=0,t=r.length;e<t;++e){let t=r[e]-i;o+=t*t}return{score:o,indices:r}},e.matchSumOfDeltas=function(e,n,i=0){let r=t(e,n,i);if(!r)return null;let o=0,s=i-1;for(let e=0,t=r.length;e<t;++e){let t=r[e];o+=t-s-1,s=t}return{score:o,indices:r}},e.highlight=function(e,t,n){let i=[],r=0,o=0,s=t.length;for(;r<s;){let l=t[r],a=t[r];for(;++r<s&&t[r]===a+1;)a++;o<l&&i.push(e.slice(o,l)),l<a+1&&i.push(n(e.slice(l,a+1))),o=a+1}return o<e.length&&i.push(e.slice(o)),i},e.cmp=function(e,t){return e<t?-1:e>t?1:0}}(s||(s={}));!function(e){e.createPluginData=function(e){var t,n,i,r;return{id:e.id,description:null!==(t=e.description)&&void 0!==t?t:"",service:null,promise:null,activated:!1,activate:e.activate,deactivate:null!==(n=e.deactivate)&&void 0!==n?n:null,provides:null!==(i=e.provides)&&void 0!==i?i:null,autoStart:null!==(r=e.autoStart)&&void 0!==r&&r,requires:e.requires?e.requires.slice():[],optional:e.optional?e.optional.slice():[]}},e.ensureNoCycle=function(e,t,n){const i=[...e.requires,...e.optional],r=i=>{if(i===e.provides)return!0;const s=n.get(i);if(!s)return!1;const l=t.get(s),a=[...l.requires,...l.optional];return 0!==a.length&&(o.push(s),!!a.some(r)||(o.pop(),!1))};if(!e.provides||0===i.length)return;const o=[e.id];if(i.some(r))throw new ReferenceError(`Cycle detected: ${o.join(" -> ")}.`)},e.findDependents=function(e,t,n){const i=new Array,r=e=>{const r=t.get(e),o=[...r.requires,...r.optional];i.push(...o.reduce(((t,i)=>{const r=n.get(i);return r&&t.push([e,r]),t}),[]))};for(const e of t.keys())r(e);const o=i.filter((t=>t[1]===e));let s=0;for(;o.length>s;){const e=o.length,t=new Set(o.map((e=>e[0])));for(const e of t)i.filter((t=>t[1]===e)).forEach((e=>{o.includes(e)||o.push(e)}));s=e}const l=function(e){let t=[],n=new Set,i=new Map;for(const t of e)r(t);for(const[e]of i)o(e);return t;function r(e){let[t,n]=e,r=i.get(n);r?r.push(t):i.set(n,[t])}function o(e){if(n.has(e))return;n.add(e);let r=i.get(e);if(r)for(const e of r)o(e);t.push(e)}}(o),a=l.findIndex((t=>t===e));return-1===a?[e]:l.slice(0,a+1)},e.collectStartupPlugins=function(e,t){const n=new Set;for(const t of e.keys())!0===e.get(t).autoStart&&n.add(t);if(t.startPlugins)for(const e of t.startPlugins)n.add(e);if(t.ignorePlugins)for(const e of t.ignorePlugins)n.delete(e);return Array.from(n)}}(l||(l={})),e.Application=class{constructor(e){this._delegate=new n.PromiseDelegate,this._plugins=new Map,this._services=new Map,this._started=!1,this._bubblingKeydown=!1,this.commands=new t.CommandRegistry,this.contextMenu=new i.ContextMenu({commands:this.commands,renderer:e.contextMenuRenderer}),this.shell=e.shell}get started(){return this._delegate.promise}get bubblingKeydown(){return this._bubblingKeydown}set bubblingKeydown(e){document.removeEventListener("keydown",this,!this._bubblingKeydown),this._bubblingKeydown=e,document.addEventListener("keydown",this,!this._bubblingKeydown)}getPluginDescription(e){var t,n;return null!==(n=null===(t=this._plugins.get(e))||void 0===t?void 0:t.description)&&void 0!==n?n:""}hasPlugin(e){return this._plugins.has(e)}isPluginActivated(e){var t,n;return null!==(n=null===(t=this._plugins.get(e))||void 0===t?void 0:t.activated)&&void 0!==n&&n}listPlugins(){return Array.from(this._plugins.keys())}registerPlugin(e){if(this._plugins.has(e.id))throw new TypeError(`Plugin '${e.id}' is already registered.`);const t=l.createPluginData(e);l.ensureNoCycle(t,this._plugins,this._services),t.provides&&this._services.set(t.provides,t.id),this._plugins.set(t.id,t)}registerPlugins(e){for(const t of e)this.registerPlugin(t)}deregisterPlugin(e,t){const n=this._plugins.get(e);if(n){if(n.activated&&!t)throw new Error(`Plugin '${e}' is still active.`);this._plugins.delete(e)}}async activatePlugin(e){const t=this._plugins.get(e);if(!t)throw new ReferenceError(`Plugin '${e}' is not registered.`);if(t.activated)return;if(t.promise)return t.promise;const n=t.requires.map((e=>this.resolveRequiredService(e))),i=t.optional.map((e=>this.resolveOptionalService(e)));return t.promise=Promise.all([...n,...i]).then((e=>t.activate.apply(void 0,[this,...e]))).then((e=>{t.service=e,t.activated=!0,t.promise=null})).catch((e=>{throw t.promise=null,e})),t.promise}async deactivatePlugin(e){const t=this._plugins.get(e);if(!t)throw new ReferenceError(`Plugin '${e}' is not registered.`);if(!t.activated)return[];if(!t.deactivate)throw new TypeError(`Plugin '${e}'#deactivate() method missing`);const n=l.findDependents(e,this._plugins,this._services),i=n.map((e=>this._plugins.get(e)));for(const t of i)if(!t.deactivate)throw new TypeError(`Plugin ${t.id}#deactivate() method missing (depends on ${e})`);for(const e of i){const t=[...e.requires,...e.optional].map((e=>{const t=this._services.get(e);return t?this._plugins.get(t).service:null}));await e.deactivate(this,...t),e.service=null,e.activated=!1}return n.pop(),n}async resolveRequiredService(e){const t=this._services.get(e);if(!t)throw new TypeError(`No provider for: ${e.name}.`);const n=this._plugins.get(t);return n.activated||await this.activatePlugin(t),n.service}async resolveOptionalService(e){const t=this._services.get(e);if(!t)return null;const n=this._plugins.get(t);if(!n.activated)try{await this.activatePlugin(t)}catch(e){return console.error(e),null}return n.service}start(e={}){if(this._started)return this._delegate.promise;this._started=!0,this._bubblingKeydown=e.bubblingKeydown||!1;const t=e.hostID||"",n=l.collectStartupPlugins(this._plugins,e).map((e=>this.activatePlugin(e).catch((t=>{console.error(`Plugin '${e}' failed to activate.`),console.error(t)}))));return Promise.all(n).then((()=>{this.attachShell(t),this.addEventListeners(),this._delegate.resolve()})),this._delegate.promise}get deferredPlugins(){return Array.from(this._plugins).filter((([e,t])=>"defer"===t.autoStart)).map((([e,t])=>e))}async activateDeferredPlugins(){const e=this.deferredPlugins.filter((e=>this._plugins.get(e).autoStart)).map((e=>this.activatePlugin(e)));await Promise.all(e)}handleEvent(e){switch(e.type){case"resize":this.evtResize(e);break;case"keydown":this.evtKeydown(e);break;case"contextmenu":this.evtContextMenu(e)}}attachShell(e){i.Widget.attach(this.shell,e&&document.getElementById(e)||document.body)}addEventListeners(){this._bubblingKeydown&&console.log("The keydown events are handled during bubbling phase"),document.addEventListener("contextmenu",this),document.addEventListener("keydown",this,!this._bubblingKeydown),window.addEventListener("resize",this)}evtKeydown(e){this.commands.processKeydownEvent(e)}evtContextMenu(e){e.shiftKey||this.contextMenu.open(e)&&(e.preventDefault(),e.stopPropagation())}evtResize(e){this.shell.update()}}}));
//# sourceMappingURL=index.min.js.map