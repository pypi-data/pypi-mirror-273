"use strict";(self.webpackChunk_amphi_pipeline_log_console=self.webpackChunk_amphi_pipeline_log_console||[]).push([[684],{684:(e,t,s)=>{s.r(t),s.d(t,{default:()=>S});var n=s(923),o=s(626),i=s(236),r=s(527),a=s(881),l=s(602);class c{constructor(e){this._isDisposed=!1,this._disposed=new l.Signal(this),this._rendermime=null,this._connector=e}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}get rendermime(){return this._rendermime}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),l.Signal.clearData(this))}}class d extends c{constructor(e){var t;super(e.connector),this._id=e.id,this._rendermime=null!==(t=e.rendermime)&&void 0!==t?t:null,this._ready=this._connector.ready,this._connector.kernelRestarted.connect(((e,t)=>{this._ready=this._connector.ready}))}get id(){return this._id}get ready(){return this._ready}}class h{constructor(e){this._kernelRestarted=new l.Signal(this),this._session=e.session,this._session.statusChanged.connect(((e,t)=>{switch(t){case"restarting":case"autorestarting":this._kernelRestarted.emit(this._session.ready)}}))}get kernelRestarted(){return this._kernelRestarted}get kernelLanguage(){var e;return(null===(e=this._session.session)||void 0===e?void 0:e.kernel)?this._session.session.kernel.info.then((e=>e.language_info.name)):Promise.resolve("")}get kernelName(){return this._session.kernelDisplayName}get ready(){return this._session.ready}get iopubMessage(){return this._session.iopubMessage}}var u=s(256),p=s(345),m=s.n(p),_=s(628),g=s.n(_),y=s(259);const f=({htmlData:e})=>{const[t,s]=(0,p.useState)([]),[n,o]=(0,p.useState)([]);return(0,p.useEffect)((()=>{const{data:t,headers:n}=function(e){const t=(new DOMParser).parseFromString(e,"text/html");let s=Array.from(t.querySelectorAll("table thead th")).map((e=>{var t,s;return null!==(s=null===(t=e.textContent)||void 0===t?void 0:t.trim())&&void 0!==s?s:""}));const n=t.querySelectorAll("table tbody tr");return{data:Array.from(n,((e,t)=>{const n=e.querySelectorAll("th, td"),o={index:t.toString()};if(n.length===s.length)n.forEach(((e,t)=>{var n,i;o[s[t]]=null!==(i=null===(n=e.textContent)||void 0===n?void 0:n.trim())&&void 0!==i?i:""}));else if(n.length===s.length+1)["",...s].forEach(((e,t)=>{var s,i;o[e]=null!==(i=null===(s=n[t].textContent)||void 0===s?void 0:s.trim())&&void 0!==i?i:""}));else{const t=e.querySelectorAll("td");s.forEach(((e,s)=>{var n,i,r;o[e]=null!==(r=null===(i=null===(n=t[s])||void 0===n?void 0:n.textContent)||void 0===i?void 0:i.trim())&&void 0!==r?r:""}))}return o})),headers:s}}(e);s(t),o(n.map((e=>({title:e,dataIndex:e,key:e}))))}),[e]),m().createElement(y.A,{dataSource:t,columns:n,pagination:!1,size:"small"})};class v extends u.Widget{constructor(){super(),this._source=null,this.addClass("amphi-Console"),this._title=C.createTitle(),this._title.className="amphi-Console-title",this._console=C.createConsole(),this._console.className="amphi-Console-table",this.node.appendChild(this._title),this.node.appendChild(this._console)}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this.onSourceDisposed,this),this._source=e,this._source&&this._source.disposed.connect(this.onSourceDisposed,this))}dispose(){this.isDisposed||(this.source=null,super.dispose())}onNewLog(e,t,s){if(!this.isAttached)return;this._console.tFoot||(this._console.createTFoot(),this._console.tFoot.className="amphi-Console-content");let n=this._console.tFoot.insertRow(0);n.className="amphi-Console-table-row fade-background-transition";let o=n.insertCell(0);switch(o.innerHTML=e,o.className="amphi-Console-date",t){case"info":n.style.backgroundColor="#e5f6ff",n.style.transition="background-color 1s ease-in-out",o=n.insertCell(1),o.innerHTML=s;break;case"error":n.style.backgroundColor="#ffd7d9",n.style.transition="background-color 1s ease-in-out",o=n.insertCell(1),o.innerHTML=s;break;case"data":o=n.insertCell(1),o.style.padding="0";const e=document.createElement("div");o.appendChild(e),g().render(m().createElement(f,{htmlData:s}),e)}this._console.parentElement.scrollTop=0,setTimeout((()=>{n.style.backgroundColor=""}),3e3)}onSourceDisposed(e,t){this.source=null}}var C;!function(e){const t=new Map(Object.entries({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}));e.escapeHtml=function(e){return String(e).replace(/[&<>"'/]/g,(e=>t.get(e)))},e.createConsole=function(){return document.createElement("table")},e.createTitle=function(e=""){const t=document.createElement("p");return t.innerHTML=e,t}}(C||(C={}));class b{constructor(){this._source=null,this._panel=null,this._handlers={}}hasHandler(e){return!!this._handlers[e]}getHandler(e){return this._handlers[e]}addHandler(e){this._handlers[e.id]=e}get panel(){return this._panel}set panel(e){this.panel!==e&&(this._panel=e,e&&!e.source&&(e.source=this._source))}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this._onSourceDisposed,this),this._source=e,this._panel&&!this._panel.isDisposed&&(this._panel.source=this._source),this._source&&this._source.disposed.connect(this._onSourceDisposed,this))}_onSourceDisposed(){this._source=null}}var k=s(262);const w=new k.Token("jupyterlab_extension/logconsole:IPipelineConsoleManager");var x;new k.Token("jupyterlab_extension/logconsole:IPipelineConsole"),function(e){e.open="pipeline-console:open"}(x||(x={}));const S=[{id:"@amphi/pipeline-log-console",requires:[n.ICommandPalette,o.ILayoutRestorer,o.ILabShell],provides:w,autoStart:!0,activate:(e,t,s,o)=>{const i=new b,a=x.open,l=new n.WidgetTracker({namespace:"pipeline-console"});return s.restore(l,{command:a,args:()=>({}),name:()=>"amphi-logConsole"}),e.commands.addCommand(a,{label:"Pipeline Console",execute:()=>{let t=null;for(const s of e.shell.widgets("main"))if("amphi-metadataPanel"===s.id){t=s;break}i.panel&&!i.panel.isDisposed||(i.panel=function(){const e=new v;return e.id="amphi-logConsole",e.title.label="Pipeline Console",e.title.icon=r.listIcon,e.title.closable=!0,e.disposed.connect((()=>{i.panel===e&&(i.panel=null)})),l.add(e),e}()),t&&t.isAttached?i.panel.isAttached||e.shell.add(i.panel,"main",{ref:t.id,mode:"tab-after"}):i.panel.isAttached||e.shell.add(i.panel,"main",{mode:"split-bottom"}),e.shell.activateById(i.panel.id)}}),t.addItem({command:a,category:"Pipeline Console"}),console.log("JupyterLab extension @amphi/pipeline-log-console is activated!"),i}},{id:"@amphi/pipeline-log-console:pipelines",requires:[w,a.IPipelineTracker,o.ILabShell],autoStart:!0,activate:(e,t,s,o)=>{const r={};function a(e){const t=new Date(e);return`${t.toLocaleDateString()}\n${t.toLocaleTimeString()}`}s.widgetAdded.connect(((e,s)=>{t.hasHandler(s.context.sessionContext.path)?r[s.id]=new Promise(((e,n)=>{e(t.getHandler(s.context.sessionContext.path))})):r[s.id]=new Promise(((e,o)=>{const l=s.context.sessionContext,c=new h({session:l}),u={connector:c,id:l.path},p=new d(u);t.addHandler(p),s.disposed.connect((()=>{delete r[s.id],p.dispose()})),p.ready.then((()=>{e(p),c.ready.then((async()=>{l.session.kernel.anyMessage.connect(((e,s)=>{if(t.panel&&"recv"===s.direction)if("execute_result"===s.msg.header.msg_type||"display_data"===s.msg.header.msg_type){const e=s.msg.content;e.data["text/html"]&&t.panel.onNewLog(a(s.msg.header.date),"data",e.data["text/html"])}else if("stream"===s.msg.header.msg_type){const e=s.msg;if(e.content.text&&"\n"!==e.content.text){const o=document.createElement("div"),r={host:o,source:e.content.text,sanitizer:new n.Sanitizer};(0,i.renderText)(r).then((()=>{const e=o.outerHTML;t.panel.onNewLog(a(s.msg.header.date),"info",e)}))}}else if("error"===s.msg.header.msg_type){const e=s.msg,o=e.content.traceback.join("\n"),r=`traceback-${Date.now()}`,l=document.createElement("div"),c=`${e.content.evalue}`;l.innerHTML=`<pre><span>${c}</span><br><a href="#" style="text-decoration: underline; color: grey;" id="link-${r}" onClick="document.getElementById('${r}').style.display = document.getElementById('${r}').style.display === 'none' ? 'block' : 'none'; return false;">Show Traceback</a></pre>`;const d=document.createElement("pre");d.id=r,d.style.display="none",l.appendChild(d);const h={host:d,source:o,sanitizer:new n.Sanitizer};(0,i.renderText)(h).then((()=>{const s=l.outerHTML;t.panel.onNewLog(a(e.header.date),"error",s)}))}}))}))}))})),l(o)}));const l=(e,n)=>{var o;const i=null!==(o=null==n?void 0:n.newValue)&&void 0!==o?o:e.currentWidget;i&&s.has(i)&&r[i.id].then((e=>{e&&(t.source=e)}))};l(o),o.currentChanged.connect(l)}}]}}]);