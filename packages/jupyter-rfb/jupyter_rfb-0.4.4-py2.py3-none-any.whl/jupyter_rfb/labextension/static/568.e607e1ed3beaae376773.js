(self.webpackChunkjupyter_rfb=self.webpackChunkjupyter_rfb||[]).push([[568],{568:(e,t,i)=>{e.exports=i(367),e.exports.version=i(147).version},367:(e,t,i)=>{var s=i(337),n=i(431),o=s.DOMWidgetModel.extend({defaults:n.extend(s.DOMWidgetModel.prototype.defaults(),{_model_name:"RemoteFrameBufferModel",_view_name:"RemoteFrameBufferView",_model_module:"jupyter_rfb",_view_module:"jupyter_rfb",_model_module_version:"0.1.0",_view_module_version:"0.1.0",frame_feedback:{},css_width:"500px",css_height:"300px",resizable:!0,has_visible_views:!1}),initialize:function(){o.__super__.initialize.apply(this,arguments),window.rfb_model=this,this.img_elements=[],this._intersection_observer=new IntersectionObserver(this._intersection_callback.bind(this)),window.setInterval(this.collect_view_img_elements.bind(this),5e3),this.frames=[],this.on("msg:custom",this.on_msg,this),this.last_frame={src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVR42mOor68HAAL+AX6E2KOJAAAAAElFTkSuQmCC",index:0,timestamp:0},this._img_update_pending=!1,this._request_animation_frame()},collect_view_img_elements:async function(){this._intersection_observer.disconnect();for(let e of this.img_elements)e.onload=null;this.img_elements=[];for(let e in this.views){let t=await this.views[e];this._intersection_observer.observe(t.img),this.img_elements.push(t.img),t.img.onload=this._request_animation_frame.bind(this)}this._request_animation_frame()},on_msg:function(e,t){"framebufferdata"===e.type&&this.frames.push(e)},_intersection_callback:function(e,t){for(let t of e)t.target._is_visible=t.isIntersecting;let i=0;for(let e of this.img_elements)e._is_visible&&(i+=1);let s=i>0;s!=this.get("has_visible_views")&&(this.set("has_visible_views",s),this.save_changes())},_send_response:function(){let e=this.last_frame,t={index:e.index,timestamp:e.timestamp,localtime:Date.now()/1e3};this.set("frame_feedback",t),this.save_changes()},_request_animation_frame:function(){if(!this._img_update_pending){this._img_update_pending=!0;let e=this._animate.bind(this);window.setTimeout(window.requestAnimationFrame,5,e)}},_animate:function(){if(this._img_update_pending=!1,!this.frames.length)return void this._request_animation_frame();let e=this.frames.shift();for(let t of this.img_elements)t.src=e.src;this.last_frame=e,this._send_response(),0===this.img_elements.length&&this._request_animation_frame()},close:function(){this.send({event_type:"close"}),o.__super__.close.apply(this,arguments)}}),l=s.DOMWidgetView.extend({render:function(){var e=this;for(let e of document.getElementsByClassName("initial-snapshot-"+this.model.model_id))e.style.display="none";function t(){let t=e._wheel_state.e,i=e.img.getBoundingClientRect(),s={event_type:"wheel",x:Number(t.clientX-i.left),y:Number(t.clientY-i.top),dx:e._wheel_state.dx,dy:e._wheel_state.dy,modifiers:h(t)};e._wheel_state.dx=0,e._wheel_state.dy=0,e._wheel_state.pending=!1,e.send(s)}function i(t){if(null===e.el.offsetParent)return;let i={event_type:"key_"+t.type.slice(3),key:r[t.key]||t.key,modifiers:h(t)};t.repeat||e.send(i),t.stopPropagation(),t.preventDefault()}this.focus_el=document.createElement("a"),this.focus_el.href="#",this.focus_el.style.position="absolute",this.focus_el.style.width="1px",this.focus_el.style.height="1px",this.focus_el.style.padding="0",this.focus_el.style.zIndex="-99",this.el.appendChild(this.focus_el),this.img=new Image,this.img.decoding="sync",this.img.loading="eager",this.img.style.touchAction="none",this.img.ondragstart=()=>!1,this.img.tabIndex=-1,this.img.oncontextmenu=function(e){if(!e.shiftKey)return e.preventDefault(),e.stopPropagation(),!1},this.img.src=this.model.last_frame.src,this.el.appendChild(this.img),this.model.collect_view_img_elements(),this._throttlers={},this.img.style.width="100%",this.img.style.height="100%",this.el.style.resize=this.model.get("resizable")?"both":"none",window.setTimeout((()=>{this.el.style.width=this.model.get("css_width")}),1),window.setTimeout((()=>{this.el.style.height=this.model.get("css_height")}),1),this.model.on("change:css_width",(function(){this.el.style.width=this.model.get("css_width")}),this),this.model.on("change:css_height",(function(){this.el.style.height=this.model.get("css_height")}),this),this.model.on("change:resizable",(function(){this.el.style.resize=this.model.get("resizable")?"both":"none"}),this),this._current_size=[0,0,1],this._resizeObserver=new ResizeObserver(this._check_resize.bind(e)),this._resizeObserver.observe(this.img),window.addEventListener("resize",this._check_resize.bind(this)),this._pointers={},this.img.addEventListener("pointerdown",(function(t){e.focus_el.focus(),e.img.setPointerCapture(t.pointerId),e._pointers[t.pointerId]=t;let i=_(e.img,t,e._pointers,"pointer_down");e.send(i),t.altKey||t.preventDefault()})),this.img.addEventListener("lostpointercapture",(function(t){let i=_(e.img,t,e._pointers,"pointer_up");delete e._pointers[t.pointerId],e.send(i)})),this.img.addEventListener("pointermove",(function(t){if(void 0===e._pointers[t.pointerId]&&Object.keys(e._pointers).length>0)return;let i=_(e.img,t,e._pointers,"pointer_move");e.send_throttled(i,20)})),this.img.addEventListener("dblclick",(function(t){let i=_(e.img,t,{},"double_click");delete i.touches,delete i.ntouches,e.send(i),t.altKey||t.preventDefault()})),this._wheel_state={dx:0,dy:0,e:null,pending:!1},this.img.addEventListener("wheel",(function(i){if(window.document.activeElement!==e.focus_el)return;let s=[1/window.devicePixelRatio,16,600][i.deltaMode];e._wheel_state.dx+=i.deltaX*s,e._wheel_state.dy+=i.deltaY*s,e._wheel_state.pending||(e._wheel_state.pending=!0,e._wheel_state.e=i,window.setTimeout(t,20)),i.altKey||i.preventDefault()})),this.focus_el.addEventListener("keydown",i,!0),this.focus_el.addEventListener("keyup",i,!0)},remove:function(){l.__super__.remove.apply(this,arguments),window.setTimeout(this.model.collect_view_img_elements.bind(this.model),10)},_check_resize:function(){let e=this.img.clientWidth,t=this.img.clientHeight,i=window.devicePixelRatio;0===e&&0===t||this._current_size[0]===e&&this._current_size[1]===t&&this._current_size[2]===i||(this._current_size=[e,t,i],this.send_throttled({event_type:"resize",width:e,height:t,pixel_ratio:i},200))},send_throttled:function(e,t){let i=e.event_type||"",s=this._throttlers[i];void 0===s&&(s=function(e,t){var i,s,n,o=null,l=0,r=function(){l=Date.now(),o=null,n=e.apply(i,s),o||(i=s=null)};return function(){var h=Date.now(),_=t-(h-l);return i=this,s=arguments,_<=0||_>t?(o&&(clearTimeout(o),o=null),l=h,n=e.apply(i,s),o||(i=s=null)):o||(o=setTimeout(r,_)),n}}(this.send,t||50),this._throttlers[i]=s),s.call(this,e)}}),r={Ctrl:"Control",Del:"Delete",Esc:"Escape"};function h(e){return["Alt","Shift","Ctrl","Meta"].filter((t=>e[t.toLowerCase()+"Key"])).map((e=>r[e]||e))}function _(e,t,i,s){let n=e.getBoundingClientRect(),o=[n.left,n.top],l=Number(t.clientX-o[0]),r=Number(t.clientY-o[1]),_={},d=0;for(let e in i){let t=i[e],s={x:Number(t.clientX-o[0]),y:Number(t.clientY-o[1]),pressure:t.pressure};_[t.pointerId]=s,d+=1}var a={0:1,1:3,2:2,3:4,4:5,5:6}[t.button]||0,m=[];for(let e of[0,1,2,3,4,5])1<<e&t.buttons&&m.push(e+1);return{event_type:s,x:l,y:r,button:a,buttons:m,modifiers:h(t),ntouches:d,touches:_}}e.exports={RemoteFrameBufferModel:o,RemoteFrameBufferView:l}},147:e=>{"use strict";e.exports={version:"0.1.0"}}}]);